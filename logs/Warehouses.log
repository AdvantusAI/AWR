2025-04-17 00:19:59,545 - Warehouses - INFO - [<warehouse_replenishment.models.Warehouse object at 0x000001652ABEAF90>, <warehouse_replenishment.models.Warehouse object at 0x000001652AC6E850>, <warehouse_replenishment.models.Warehouse object at 0x000001652AC6ED50>]
2025-04-17 00:19:59,552 - Warehouses - ERROR - Error processing warehouse 1: (psycopg2.errors.UndefinedFunction) el operador no existe: character varying = integer
LINE 3: WHERE item.warehouse_id = 1 AND item.buyer_class IN ('REGULA...
                                ^
HINT:  Ning�n operador coincide en el nombre y tipos de argumentos. Puede ser necesario agregar conversi�n expl�cita de tipos.

[SQL: SELECT item.id AS item_id_1, item.item_id AS item_item_id, item.description AS item_description, item.vendor_id AS item_vendor_id, item.warehouse_id AS item_warehouse_id, item.service_level_goal AS item_service_level_goal, item.service_level_maintained AS item_service_level_maintained, item.service_level_attained AS item_service_level_attained, item.suggested_service_level AS item_suggested_service_level, item.on_hand AS item_on_hand, item.on_order AS item_on_order, item.customer_back_order AS item_customer_back_order, item.reserved AS item_reserved, item.held_until AS item_held_until, item.quantity_held AS item_quantity_held, item.lead_time_forecast AS item_lead_time_forecast, item.lead_time_variance AS item_lead_time_variance, item.lead_time_maintained AS item_lead_time_maintained, item.calculated_in_days AS item_calculated_in_days, item.calculated_variance AS item_calculated_variance, item.lead_time_profile AS item_lead_time_profile, item.fill_in_lead_time AS item_fill_in_lead_time, item.units_per_case AS item_units_per_case, item.weight_per_unit AS item_weight_per_unit, item.volume_per_unit AS item_volume_per_unit, item.units_per_layer AS item_units_per_layer, item.units_per_pallet AS item_units_per_pallet, item.buying_multiple AS item_buying_multiple, item.minimum_quantity AS item_minimum_quantity, item.convenience_pack AS item_convenience_pack, item.conv_pk_breakpoint AS item_conv_pk_breakpoint, item.number_of_conv_packs AS item_number_of_conv_packs, item.shelf_life_days AS item_shelf_life_days, item.out_of_stock_point AS item_out_of_stock_point, item.buyer_class AS item_buyer_class, item.system_class AS item_system_class, item.forecast_method AS item_forecast_method, item.forecasting_periodicity AS item_forecasting_periodicity, item.history_periodicity AS item_history_periodicity, item.item_group_codes AS item_item_group_codes, item.demand_weekly AS item_demand_weekly, item.demand_4weekly AS item_demand_4weekly, item.demand_monthly AS item_demand_monthly, item.demand_quarterly AS item_demand_quarterly, item.demand_yearly AS item_demand_yearly, item.forecast_date AS item_forecast_date, item.madp AS item_madp, item.track AS item_track, item.sstf AS item_sstf, item.freeze_until_date AS item_freeze_until_date, item.demand_profile AS item_demand_profile, item.buyer_max AS item_buyer_max, item.buyer_min AS item_buyer_min, item.type_for_min_max AS item_type_for_min_max, item.manual_ss AS item_manual_ss, item.ss_type AS item_ss_type, item.purchase_price AS item_purchase_price, item.purchase_price_divisor AS item_purchase_price_divisor, item.sales_price AS item_sales_price, item.carrying_cost_adjustments AS item_carrying_cost_adjustments, item.handling_cost_adjustments AS item_handling_cost_adjustments, item.supersede_to_item_id AS item_supersede_to_item_id, item.supersede_from_item_id AS item_supersede_from_item_id, item.item_order_point_units AS item_item_order_point_units, item.item_order_point_days AS item_item_order_point_days, item.vendor_order_point_days AS item_vendor_order_point_days, item.order_up_to_level_units AS item_order_up_to_level_units, item.order_up_to_level_days AS item_order_up_to_level_days, item.item_cycle_units AS item_item_cycle_units, item.item_cycle_days AS item_item_cycle_days 
FROM item 
WHERE item.warehouse_id = %(warehouse_id_1)s AND item.buyer_class IN (%(buyer_class_1_1)s, %(buyer_class_1_2)s) AND (item.freeze_until_date IS NULL OR item.freeze_until_date < CURRENT_DATE)]
[parameters: {'warehouse_id_1': 1, 'buyer_class_1_1': BuyerClassCode.REGULAR, 'buyer_class_1_2': BuyerClassCode.WATCH}]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):
  File "C:\Users\vhvaz\AppData\Roaming\Python\Python313\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\vhvaz\AppData\Roaming\Python\Python313\site-packages\sqlalchemy\engine\default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.errors.UndefinedFunction: el operador no existe: character varying = integer
LINE 3: WHERE item.warehouse_id = 1 AND item.buyer_class IN ('REGULA...
                                ^
HINT:  Ning�n operador coincide en el nombre y tipos de argumentos. Puede ser necesario agregar conversi�n expl�cita de tipos.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\Personal\Code\AWR\warehouse_replenishment\batch\period_end_job.py", line 124, in process_warehouse
    reforecast_results = reforecast_items(warehouse_id, session)
  File "D:\Personal\Code\AWR\warehouse_replenishment\batch\period_end_job.py", line 178, in reforecast_items
    results = forecast_service.process_period_end_reforecasting(warehouse_id=warehouse_id)
  File "D:\Personal\Code\AWR\warehouse_replenishment\services\forecast_service.py", line 747, in process_period_end_reforecasting
    items = query.all()
  File "C:\Users\vhvaz\AppData\Roaming\Python\Python313\site-packages\sqlalchemy\orm\query.py", line 2704, in all
    return self._iter().all()  # type: ignore
           ~~~~~~~~~~^^
  File "C:\Users\vhvaz\AppData\Roaming\Python\Python313\site-packages\sqlalchemy\orm\query.py", line 2858, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ~~~~~~~~~~~~~~~~~~~~^
        statement,
        ^^^^^^^^^^
        params,
        ^^^^^^^
        execution_options={"_sa_orm_load_options": self.load_options},
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\vhvaz\AppData\Roaming\Python\Python313\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ~~~~~~~~~~~~~~~~~~~~~~^
        statement,
        ^^^^^^^^^^
    ...<4 lines>...
        _add_event=_add_event,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\vhvaz\AppData\Roaming\Python\Python313\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self,
        ^^^^^
    ...<4 lines>...
        conn,
        ^^^^^
    )
    ^
  File "C:\Users\vhvaz\AppData\Roaming\Python\Python313\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
        statement, params or {}, execution_options=execution_options
    )
  File "C:\Users\vhvaz\AppData\Roaming\Python\Python313\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "C:\Users\vhvaz\AppData\Roaming\Python\Python313\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\vhvaz\AppData\Roaming\Python\Python313\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "C:\Users\vhvaz\AppData\Roaming\Python\Python313\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\vhvaz\AppData\Roaming\Python\Python313\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\vhvaz\AppData\Roaming\Python\Python313\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\vhvaz\AppData\Roaming\Python\Python313\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\vhvaz\AppData\Roaming\Python\Python313\site-packages\sqlalchemy\engine\default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedFunction) el operador no existe: character varying = integer
LINE 3: WHERE item.warehouse_id = 1 AND item.buyer_class IN ('REGULA...
                                ^
HINT:  Ning�n operador coincide en el nombre y tipos de argumentos. Puede ser necesario agregar conversi�n expl�cita de tipos.

[SQL: SELECT item.id AS item_id_1, item.item_id AS item_item_id, item.description AS item_description, item.vendor_id AS item_vendor_id, item.warehouse_id AS item_warehouse_id, item.service_level_goal AS item_service_level_goal, item.service_level_maintained AS item_service_level_maintained, item.service_level_attained AS item_service_level_attained, item.suggested_service_level AS item_suggested_service_level, item.on_hand AS item_on_hand, item.on_order AS item_on_order, item.customer_back_order AS item_customer_back_order, item.reserved AS item_reserved, item.held_until AS item_held_until, item.quantity_held AS item_quantity_held, item.lead_time_forecast AS item_lead_time_forecast, item.lead_time_variance AS item_lead_time_variance, item.lead_time_maintained AS item_lead_time_maintained, item.calculated_in_days AS item_calculated_in_days, item.calculated_variance AS item_calculated_variance, item.lead_time_profile AS item_lead_time_profile, item.fill_in_lead_time AS item_fill_in_lead_time, item.units_per_case AS item_units_per_case, item.weight_per_unit AS item_weight_per_unit, item.volume_per_unit AS item_volume_per_unit, item.units_per_layer AS item_units_per_layer, item.units_per_pallet AS item_units_per_pallet, item.buying_multiple AS item_buying_multiple, item.minimum_quantity AS item_minimum_quantity, item.convenience_pack AS item_convenience_pack, item.conv_pk_breakpoint AS item_conv_pk_breakpoint, item.number_of_conv_packs AS item_number_of_conv_packs, item.shelf_life_days AS item_shelf_life_days, item.out_of_stock_point AS item_out_of_stock_point, item.buyer_class AS item_buyer_class, item.system_class AS item_system_class, item.forecast_method AS item_forecast_method, item.forecasting_periodicity AS item_forecasting_periodicity, item.history_periodicity AS item_history_periodicity, item.item_group_codes AS item_item_group_codes, item.demand_weekly AS item_demand_weekly, item.demand_4weekly AS item_demand_4weekly, item.demand_monthly AS item_demand_monthly, item.demand_quarterly AS item_demand_quarterly, item.demand_yearly AS item_demand_yearly, item.forecast_date AS item_forecast_date, item.madp AS item_madp, item.track AS item_track, item.sstf AS item_sstf, item.freeze_until_date AS item_freeze_until_date, item.demand_profile AS item_demand_profile, item.buyer_max AS item_buyer_max, item.buyer_min AS item_buyer_min, item.type_for_min_max AS item_type_for_min_max, item.manual_ss AS item_manual_ss, item.ss_type AS item_ss_type, item.purchase_price AS item_purchase_price, item.purchase_price_divisor AS item_purchase_price_divisor, item.sales_price AS item_sales_price, item.carrying_cost_adjustments AS item_carrying_cost_adjustments, item.handling_cost_adjustments AS item_handling_cost_adjustments, item.supersede_to_item_id AS item_supersede_to_item_id, item.supersede_from_item_id AS item_supersede_from_item_id, item.item_order_point_units AS item_item_order_point_units, item.item_order_point_days AS item_item_order_point_days, item.vendor_order_point_days AS item_vendor_order_point_days, item.order_up_to_level_units AS item_order_up_to_level_units, item.order_up_to_level_days AS item_order_up_to_level_days, item.item_cycle_units AS item_item_cycle_units, item.item_cycle_days AS item_item_cycle_days 
FROM item 
WHERE item.warehouse_id = %(warehouse_id_1)s AND item.buyer_class IN (%(buyer_class_1_1)s, %(buyer_class_1_2)s) AND (item.freeze_until_date IS NULL OR item.freeze_until_date < CURRENT_DATE)]
[parameters: {'warehouse_id_1': 1, 'buyer_class_1_1': BuyerClassCode.REGULAR, 'buyer_class_1_2': BuyerClassCode.WATCH}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-04-17 00:19:59,564 - Warehouses - ERROR - Error processing warehouse 2: (psycopg2.errors.InFailedSqlTransaction) transacci�n abortada, las �rdenes ser�n ignoradas hasta el fin de bloque de transacci�n

[SQL: SELECT item.id AS item_id_1, item.item_id AS item_item_id, item.description AS item_description, item.vendor_id AS item_vendor_id, item.warehouse_id AS item_warehouse_id, item.service_level_goal AS item_service_level_goal, item.service_level_maintained AS item_service_level_maintained, item.service_level_attained AS item_service_level_attained, item.suggested_service_level AS item_suggested_service_level, item.on_hand AS item_on_hand, item.on_order AS item_on_order, item.customer_back_order AS item_customer_back_order, item.reserved AS item_reserved, item.held_until AS item_held_until, item.quantity_held AS item_quantity_held, item.lead_time_forecast AS item_lead_time_forecast, item.lead_time_variance AS item_lead_time_variance, item.lead_time_maintained AS item_lead_time_maintained, item.calculated_in_days AS item_calculated_in_days, item.calculated_variance AS item_calculated_variance, item.lead_time_profile AS item_lead_time_profile, item.fill_in_lead_time AS item_fill_in_lead_time, item.units_per_case AS item_units_per_case, item.weight_per_unit AS item_weight_per_unit, item.volume_per_unit AS item_volume_per_unit, item.units_per_layer AS item_units_per_layer, item.units_per_pallet AS item_units_per_pallet, item.buying_multiple AS item_buying_multiple, item.minimum_quantity AS item_minimum_quantity, item.convenience_pack AS item_convenience_pack, item.conv_pk_breakpoint AS item_conv_pk_breakpoint, item.number_of_conv_packs AS item_number_of_conv_packs, item.shelf_life_days AS item_shelf_life_days, item.out_of_stock_point AS item_out_of_stock_point, item.buyer_class AS item_buyer_class, item.system_class AS item_system_class, item.forecast_method AS item_forecast_method, item.forecasting_periodicity AS item_forecasting_periodicity, item.history_periodicity AS item_history_periodicity, item.item_group_codes AS item_item_group_codes, item.demand_weekly AS item_demand_weekly, item.demand_4weekly AS item_demand_4weekly, item.demand_monthly AS item_demand_monthly, item.demand_quarterly AS item_demand_quarterly, item.demand_yearly AS item_demand_yearly, item.forecast_date AS item_forecast_date, item.madp AS item_madp, item.track AS item_track, item.sstf AS item_sstf, item.freeze_until_date AS item_freeze_until_date, item.demand_profile AS item_demand_profile, item.buyer_max AS item_buyer_max, item.buyer_min AS item_buyer_min, item.type_for_min_max AS item_type_for_min_max, item.manual_ss AS item_manual_ss, item.ss_type AS item_ss_type, item.purchase_price AS item_purchase_price, item.purchase_price_divisor AS item_purchase_price_divisor, item.sales_price AS item_sales_price, item.carrying_cost_adjustments AS item_carrying_cost_adjustments, item.handling_cost_adjustments AS item_handling_cost_adjustments, item.supersede_to_item_id AS item_supersede_to_item_id, item.supersede_from_item_id AS item_supersede_from_item_id, item.item_order_point_units AS item_item_order_point_units, item.item_order_point_days AS item_item_order_point_days, item.vendor_order_point_days AS item_vendor_order_point_days, item.order_up_to_level_units AS item_order_up_to_level_units, item.order_up_to_level_days AS item_order_up_to_level_days, item.item_cycle_units AS item_item_cycle_units, item.item_cycle_days AS item_item_cycle_days 
FROM item 
WHERE item.warehouse_id = %(warehouse_id_1)s AND item.buyer_class IN (%(buyer_class_1_1)s, %(buyer_class_1_2)s) AND (item.freeze_until_date IS NULL OR item.freeze_until_date < CURRENT_DATE)]
[parameters: {'warehouse_id_1': 2, 'buyer_class_1_1': BuyerClassCode.REGULAR, 'buyer_class_1_2': BuyerClassCode.WATCH}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
Traceback (most recent call last):
  File "C:\Users\vhvaz\AppData\Roaming\Python\Python313\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\vhvaz\AppData\Roaming\Python\Python313\site-packages\sqlalchemy\engine\default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.errors.InFailedSqlTransaction: transacci�n abortada, las �rdenes ser�n ignoradas hasta el fin de bloque de transacci�n


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\Personal\Code\AWR\warehouse_replenishment\batch\period_end_job.py", line 124, in process_warehouse
    reforecast_results = reforecast_items(warehouse_id, session)
  File "D:\Personal\Code\AWR\warehouse_replenishment\batch\period_end_job.py", line 178, in reforecast_items
    results = forecast_service.process_period_end_reforecasting(warehouse_id=warehouse_id)
  File "D:\Personal\Code\AWR\warehouse_replenishment\services\forecast_service.py", line 747, in process_period_end_reforecasting
    items = query.all()
  File "C:\Users\vhvaz\AppData\Roaming\Python\Python313\site-packages\sqlalchemy\orm\query.py", line 2704, in all
    return self._iter().all()  # type: ignore
           ~~~~~~~~~~^^
  File "C:\Users\vhvaz\AppData\Roaming\Python\Python313\site-packages\sqlalchemy\orm\query.py", line 2858, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ~~~~~~~~~~~~~~~~~~~~^
        statement,
        ^^^^^^^^^^
        params,
        ^^^^^^^
        execution_options={"_sa_orm_load_options": self.load_options},
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\vhvaz\AppData\Roaming\Python\Python313\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ~~~~~~~~~~~~~~~~~~~~~~^
        statement,
        ^^^^^^^^^^
    ...<4 lines>...
        _add_event=_add_event,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\vhvaz\AppData\Roaming\Python\Python313\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self,
        ^^^^^
    ...<4 lines>...
        conn,
        ^^^^^
    )
    ^
  File "C:\Users\vhvaz\AppData\Roaming\Python\Python313\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
        statement, params or {}, execution_options=execution_options
    )
  File "C:\Users\vhvaz\AppData\Roaming\Python\Python313\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "C:\Users\vhvaz\AppData\Roaming\Python\Python313\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\vhvaz\AppData\Roaming\Python\Python313\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "C:\Users\vhvaz\AppData\Roaming\Python\Python313\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\vhvaz\AppData\Roaming\Python\Python313\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\vhvaz\AppData\Roaming\Python\Python313\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\vhvaz\AppData\Roaming\Python\Python313\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\vhvaz\AppData\Roaming\Python\Python313\site-packages\sqlalchemy\engine\default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) transacci�n abortada, las �rdenes ser�n ignoradas hasta el fin de bloque de transacci�n

[SQL: SELECT item.id AS item_id_1, item.item_id AS item_item_id, item.description AS item_description, item.vendor_id AS item_vendor_id, item.warehouse_id AS item_warehouse_id, item.service_level_goal AS item_service_level_goal, item.service_level_maintained AS item_service_level_maintained, item.service_level_attained AS item_service_level_attained, item.suggested_service_level AS item_suggested_service_level, item.on_hand AS item_on_hand, item.on_order AS item_on_order, item.customer_back_order AS item_customer_back_order, item.reserved AS item_reserved, item.held_until AS item_held_until, item.quantity_held AS item_quantity_held, item.lead_time_forecast AS item_lead_time_forecast, item.lead_time_variance AS item_lead_time_variance, item.lead_time_maintained AS item_lead_time_maintained, item.calculated_in_days AS item_calculated_in_days, item.calculated_variance AS item_calculated_variance, item.lead_time_profile AS item_lead_time_profile, item.fill_in_lead_time AS item_fill_in_lead_time, item.units_per_case AS item_units_per_case, item.weight_per_unit AS item_weight_per_unit, item.volume_per_unit AS item_volume_per_unit, item.units_per_layer AS item_units_per_layer, item.units_per_pallet AS item_units_per_pallet, item.buying_multiple AS item_buying_multiple, item.minimum_quantity AS item_minimum_quantity, item.convenience_pack AS item_convenience_pack, item.conv_pk_breakpoint AS item_conv_pk_breakpoint, item.number_of_conv_packs AS item_number_of_conv_packs, item.shelf_life_days AS item_shelf_life_days, item.out_of_stock_point AS item_out_of_stock_point, item.buyer_class AS item_buyer_class, item.system_class AS item_system_class, item.forecast_method AS item_forecast_method, item.forecasting_periodicity AS item_forecasting_periodicity, item.history_periodicity AS item_history_periodicity, item.item_group_codes AS item_item_group_codes, item.demand_weekly AS item_demand_weekly, item.demand_4weekly AS item_demand_4weekly, item.demand_monthly AS item_demand_monthly, item.demand_quarterly AS item_demand_quarterly, item.demand_yearly AS item_demand_yearly, item.forecast_date AS item_forecast_date, item.madp AS item_madp, item.track AS item_track, item.sstf AS item_sstf, item.freeze_until_date AS item_freeze_until_date, item.demand_profile AS item_demand_profile, item.buyer_max AS item_buyer_max, item.buyer_min AS item_buyer_min, item.type_for_min_max AS item_type_for_min_max, item.manual_ss AS item_manual_ss, item.ss_type AS item_ss_type, item.purchase_price AS item_purchase_price, item.purchase_price_divisor AS item_purchase_price_divisor, item.sales_price AS item_sales_price, item.carrying_cost_adjustments AS item_carrying_cost_adjustments, item.handling_cost_adjustments AS item_handling_cost_adjustments, item.supersede_to_item_id AS item_supersede_to_item_id, item.supersede_from_item_id AS item_supersede_from_item_id, item.item_order_point_units AS item_item_order_point_units, item.item_order_point_days AS item_item_order_point_days, item.vendor_order_point_days AS item_vendor_order_point_days, item.order_up_to_level_units AS item_order_up_to_level_units, item.order_up_to_level_days AS item_order_up_to_level_days, item.item_cycle_units AS item_item_cycle_units, item.item_cycle_days AS item_item_cycle_days 
FROM item 
WHERE item.warehouse_id = %(warehouse_id_1)s AND item.buyer_class IN (%(buyer_class_1_1)s, %(buyer_class_1_2)s) AND (item.freeze_until_date IS NULL OR item.freeze_until_date < CURRENT_DATE)]
[parameters: {'warehouse_id_1': 2, 'buyer_class_1_1': BuyerClassCode.REGULAR, 'buyer_class_1_2': BuyerClassCode.WATCH}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
2025-04-17 00:19:59,569 - Warehouses - ERROR - Error processing warehouse 3: (psycopg2.errors.InFailedSqlTransaction) transacci�n abortada, las �rdenes ser�n ignoradas hasta el fin de bloque de transacci�n

[SQL: SELECT item.id AS item_id_1, item.item_id AS item_item_id, item.description AS item_description, item.vendor_id AS item_vendor_id, item.warehouse_id AS item_warehouse_id, item.service_level_goal AS item_service_level_goal, item.service_level_maintained AS item_service_level_maintained, item.service_level_attained AS item_service_level_attained, item.suggested_service_level AS item_suggested_service_level, item.on_hand AS item_on_hand, item.on_order AS item_on_order, item.customer_back_order AS item_customer_back_order, item.reserved AS item_reserved, item.held_until AS item_held_until, item.quantity_held AS item_quantity_held, item.lead_time_forecast AS item_lead_time_forecast, item.lead_time_variance AS item_lead_time_variance, item.lead_time_maintained AS item_lead_time_maintained, item.calculated_in_days AS item_calculated_in_days, item.calculated_variance AS item_calculated_variance, item.lead_time_profile AS item_lead_time_profile, item.fill_in_lead_time AS item_fill_in_lead_time, item.units_per_case AS item_units_per_case, item.weight_per_unit AS item_weight_per_unit, item.volume_per_unit AS item_volume_per_unit, item.units_per_layer AS item_units_per_layer, item.units_per_pallet AS item_units_per_pallet, item.buying_multiple AS item_buying_multiple, item.minimum_quantity AS item_minimum_quantity, item.convenience_pack AS item_convenience_pack, item.conv_pk_breakpoint AS item_conv_pk_breakpoint, item.number_of_conv_packs AS item_number_of_conv_packs, item.shelf_life_days AS item_shelf_life_days, item.out_of_stock_point AS item_out_of_stock_point, item.buyer_class AS item_buyer_class, item.system_class AS item_system_class, item.forecast_method AS item_forecast_method, item.forecasting_periodicity AS item_forecasting_periodicity, item.history_periodicity AS item_history_periodicity, item.item_group_codes AS item_item_group_codes, item.demand_weekly AS item_demand_weekly, item.demand_4weekly AS item_demand_4weekly, item.demand_monthly AS item_demand_monthly, item.demand_quarterly AS item_demand_quarterly, item.demand_yearly AS item_demand_yearly, item.forecast_date AS item_forecast_date, item.madp AS item_madp, item.track AS item_track, item.sstf AS item_sstf, item.freeze_until_date AS item_freeze_until_date, item.demand_profile AS item_demand_profile, item.buyer_max AS item_buyer_max, item.buyer_min AS item_buyer_min, item.type_for_min_max AS item_type_for_min_max, item.manual_ss AS item_manual_ss, item.ss_type AS item_ss_type, item.purchase_price AS item_purchase_price, item.purchase_price_divisor AS item_purchase_price_divisor, item.sales_price AS item_sales_price, item.carrying_cost_adjustments AS item_carrying_cost_adjustments, item.handling_cost_adjustments AS item_handling_cost_adjustments, item.supersede_to_item_id AS item_supersede_to_item_id, item.supersede_from_item_id AS item_supersede_from_item_id, item.item_order_point_units AS item_item_order_point_units, item.item_order_point_days AS item_item_order_point_days, item.vendor_order_point_days AS item_vendor_order_point_days, item.order_up_to_level_units AS item_order_up_to_level_units, item.order_up_to_level_days AS item_order_up_to_level_days, item.item_cycle_units AS item_item_cycle_units, item.item_cycle_days AS item_item_cycle_days 
FROM item 
WHERE item.warehouse_id = %(warehouse_id_1)s AND item.buyer_class IN (%(buyer_class_1_1)s, %(buyer_class_1_2)s) AND (item.freeze_until_date IS NULL OR item.freeze_until_date < CURRENT_DATE)]
[parameters: {'warehouse_id_1': 3, 'buyer_class_1_1': BuyerClassCode.REGULAR, 'buyer_class_1_2': BuyerClassCode.WATCH}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
Traceback (most recent call last):
  File "C:\Users\vhvaz\AppData\Roaming\Python\Python313\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\vhvaz\AppData\Roaming\Python\Python313\site-packages\sqlalchemy\engine\default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
psycopg2.errors.InFailedSqlTransaction: transacci�n abortada, las �rdenes ser�n ignoradas hasta el fin de bloque de transacci�n


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\Personal\Code\AWR\warehouse_replenishment\batch\period_end_job.py", line 124, in process_warehouse
    reforecast_results = reforecast_items(warehouse_id, session)
  File "D:\Personal\Code\AWR\warehouse_replenishment\batch\period_end_job.py", line 178, in reforecast_items
    results = forecast_service.process_period_end_reforecasting(warehouse_id=warehouse_id)
  File "D:\Personal\Code\AWR\warehouse_replenishment\services\forecast_service.py", line 747, in process_period_end_reforecasting
    items = query.all()
  File "C:\Users\vhvaz\AppData\Roaming\Python\Python313\site-packages\sqlalchemy\orm\query.py", line 2704, in all
    return self._iter().all()  # type: ignore
           ~~~~~~~~~~^^
  File "C:\Users\vhvaz\AppData\Roaming\Python\Python313\site-packages\sqlalchemy\orm\query.py", line 2858, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ~~~~~~~~~~~~~~~~~~~~^
        statement,
        ^^^^^^^^^^
        params,
        ^^^^^^^
        execution_options={"_sa_orm_load_options": self.load_options},
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\vhvaz\AppData\Roaming\Python\Python313\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ~~~~~~~~~~~~~~~~~~~~~~^
        statement,
        ^^^^^^^^^^
    ...<4 lines>...
        _add_event=_add_event,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\vhvaz\AppData\Roaming\Python\Python313\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self,
        ^^^^^
    ...<4 lines>...
        conn,
        ^^^^^
    )
    ^
  File "C:\Users\vhvaz\AppData\Roaming\Python\Python313\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
        statement, params or {}, execution_options=execution_options
    )
  File "C:\Users\vhvaz\AppData\Roaming\Python\Python313\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "C:\Users\vhvaz\AppData\Roaming\Python\Python313\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\vhvaz\AppData\Roaming\Python\Python313\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "C:\Users\vhvaz\AppData\Roaming\Python\Python313\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\vhvaz\AppData\Roaming\Python\Python313\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\vhvaz\AppData\Roaming\Python\Python313\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\vhvaz\AppData\Roaming\Python\Python313\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\vhvaz\AppData\Roaming\Python\Python313\site-packages\sqlalchemy\engine\default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) transacci�n abortada, las �rdenes ser�n ignoradas hasta el fin de bloque de transacci�n

[SQL: SELECT item.id AS item_id_1, item.item_id AS item_item_id, item.description AS item_description, item.vendor_id AS item_vendor_id, item.warehouse_id AS item_warehouse_id, item.service_level_goal AS item_service_level_goal, item.service_level_maintained AS item_service_level_maintained, item.service_level_attained AS item_service_level_attained, item.suggested_service_level AS item_suggested_service_level, item.on_hand AS item_on_hand, item.on_order AS item_on_order, item.customer_back_order AS item_customer_back_order, item.reserved AS item_reserved, item.held_until AS item_held_until, item.quantity_held AS item_quantity_held, item.lead_time_forecast AS item_lead_time_forecast, item.lead_time_variance AS item_lead_time_variance, item.lead_time_maintained AS item_lead_time_maintained, item.calculated_in_days AS item_calculated_in_days, item.calculated_variance AS item_calculated_variance, item.lead_time_profile AS item_lead_time_profile, item.fill_in_lead_time AS item_fill_in_lead_time, item.units_per_case AS item_units_per_case, item.weight_per_unit AS item_weight_per_unit, item.volume_per_unit AS item_volume_per_unit, item.units_per_layer AS item_units_per_layer, item.units_per_pallet AS item_units_per_pallet, item.buying_multiple AS item_buying_multiple, item.minimum_quantity AS item_minimum_quantity, item.convenience_pack AS item_convenience_pack, item.conv_pk_breakpoint AS item_conv_pk_breakpoint, item.number_of_conv_packs AS item_number_of_conv_packs, item.shelf_life_days AS item_shelf_life_days, item.out_of_stock_point AS item_out_of_stock_point, item.buyer_class AS item_buyer_class, item.system_class AS item_system_class, item.forecast_method AS item_forecast_method, item.forecasting_periodicity AS item_forecasting_periodicity, item.history_periodicity AS item_history_periodicity, item.item_group_codes AS item_item_group_codes, item.demand_weekly AS item_demand_weekly, item.demand_4weekly AS item_demand_4weekly, item.demand_monthly AS item_demand_monthly, item.demand_quarterly AS item_demand_quarterly, item.demand_yearly AS item_demand_yearly, item.forecast_date AS item_forecast_date, item.madp AS item_madp, item.track AS item_track, item.sstf AS item_sstf, item.freeze_until_date AS item_freeze_until_date, item.demand_profile AS item_demand_profile, item.buyer_max AS item_buyer_max, item.buyer_min AS item_buyer_min, item.type_for_min_max AS item_type_for_min_max, item.manual_ss AS item_manual_ss, item.ss_type AS item_ss_type, item.purchase_price AS item_purchase_price, item.purchase_price_divisor AS item_purchase_price_divisor, item.sales_price AS item_sales_price, item.carrying_cost_adjustments AS item_carrying_cost_adjustments, item.handling_cost_adjustments AS item_handling_cost_adjustments, item.supersede_to_item_id AS item_supersede_to_item_id, item.supersede_from_item_id AS item_supersede_from_item_id, item.item_order_point_units AS item_item_order_point_units, item.item_order_point_days AS item_item_order_point_days, item.vendor_order_point_days AS item_vendor_order_point_days, item.order_up_to_level_units AS item_order_up_to_level_units, item.order_up_to_level_days AS item_order_up_to_level_days, item.item_cycle_units AS item_item_cycle_units, item.item_cycle_days AS item_item_cycle_days 
FROM item 
WHERE item.warehouse_id = %(warehouse_id_1)s AND item.buyer_class IN (%(buyer_class_1_1)s, %(buyer_class_1_2)s) AND (item.freeze_until_date IS NULL OR item.freeze_until_date < CURRENT_DATE)]
[parameters: {'warehouse_id_1': 3, 'buyer_class_1_1': BuyerClassCode.REGULAR, 'buyer_class_1_2': BuyerClassCode.WATCH}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
